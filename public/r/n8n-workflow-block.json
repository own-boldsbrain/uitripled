{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "n8n-workflow-block",
  "type": "registry:block",
  "title": "Bloco de Fluxo de Trabalho N8N",
  "description": "Construtor visual de automação de fluxo de trabalho com nós animados, conexões e monitoramento de execução em tempo real",
  "registryDependencies": [
    "badge",
    "button",
    "card"
  ],
  "dependencies": [
    "framer-motion",
    "lucide-react",
    "react",
    "react-dom"
  ],
  "files": [
    {
      "path": "components/sections/n8n-workflow-block.tsx",
      "content": "\"use client\";\r\n\r\nimport type React from \"react\";\r\nimport { useState, useRef } from \"react\";\r\nimport { motion, type PanInfo } from \"framer-motion\";\r\nimport { flushSync } from \"react-dom\";\r\n\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport {\r\n  ArrowRight,\r\n  Database,\r\n  Mail,\r\n  Plus,\r\n  Settings,\r\n  Webhook,\r\n  Zap,\r\n} from \"lucide-react\";\r\n\r\n// Interfaces\r\ninterface WorkflowNode {\r\n  id: string;\r\n  type: \"trigger\" | \"action\" | \"condition\";\r\n  title: string;\r\n  description: string;\r\n  icon: React.ComponentType<{ className?: string }>;\r\n  color: string;\r\n  position: { x: number; y: number };\r\n}\r\n\r\ninterface WorkflowConnection {\r\n  from: string;\r\n  to: string;\r\n}\r\n\r\n// Constants\r\nconst NODE_WIDTH = 200;\r\nconst NODE_HEIGHT = 100;\r\n\r\nconst nodeTemplates: Omit<WorkflowNode, \"id\" | \"position\">[] = [\r\n  {\r\n    type: \"trigger\",\r\n    title: \"Webhook\",\r\n    description: \"Receive data from external service\",\r\n    icon: Webhook,\r\n    color: \"emerald\",\r\n  },\r\n  {\r\n    type: \"action\",\r\n    title: \"Database Query\",\r\n    description: \"Fetch user records\",\r\n    icon: Database,\r\n    color: \"blue\",\r\n  },\r\n  {\r\n    type: \"condition\",\r\n    title: \"Condition\",\r\n    description: \"Check user status\",\r\n    icon: Settings,\r\n    color: \"amber\",\r\n  },\r\n  {\r\n    type: \"action\",\r\n    title: \"Send Email\",\r\n    description: \"Notify user\",\r\n    icon: Mail,\r\n    color: \"purple\",\r\n  },\r\n  {\r\n    type: \"action\",\r\n    title: \"Log Event\",\r\n    description: \"Record activity\",\r\n    icon: Zap,\r\n    color: \"indigo\",\r\n  },\r\n];\r\n\r\nconst initialNodes: WorkflowNode[] = [\r\n  {\r\n    id: \"node-1\",\r\n    type: \"trigger\",\r\n    title: \"Webhook\",\r\n    description: \"Receive data from external service\",\r\n    icon: Webhook,\r\n    color: \"emerald\",\r\n    position: { x: 50, y: 100 },\r\n  },\r\n  {\r\n    id: \"node-2\",\r\n    type: \"action\",\r\n    title: \"Database Query\",\r\n    description: \"Fetch user records\",\r\n    icon: Database,\r\n    color: \"blue\",\r\n    position: { x: 300, y: 100 },\r\n  },\r\n  {\r\n    id: \"node-3\",\r\n    type: \"condition\",\r\n    title: \"Condition\",\r\n    description: \"Check user status\",\r\n    icon: Settings,\r\n    color: \"amber\",\r\n    position: { x: 550, y: 100 },\r\n  },\r\n];\r\n\r\nconst initialConnections: WorkflowConnection[] = [\r\n  { from: \"node-1\", to: \"node-2\" },\r\n  { from: \"node-2\", to: \"node-3\" },\r\n];\r\n\r\nconst colorClasses: Record<string, string> = {\r\n  emerald: \"border-emerald-400/40 bg-emerald-400/10 text-emerald-400\",\r\n  blue: \"border-blue-400/40 bg-blue-400/10 text-blue-400\",\r\n  amber: \"border-amber-400/40 bg-amber-400/10 text-amber-400\",\r\n  purple: \"border-purple-400/40 bg-purple-400/10 text-purple-400\",\r\n  indigo: \"border-indigo-400/40 bg-indigo-400/10 text-indigo-400\",\r\n};\r\n\r\n// Connection Line Component\r\nfunction WorkflowConnectionLine({\r\n  from,\r\n  to,\r\n  nodes,\r\n}: {\r\n  from: string;\r\n  to: string;\r\n  nodes: WorkflowNode[];\r\n}) {\r\n  const fromNode = nodes.find((n) => n.id === from);\r\n  const toNode = nodes.find((n) => n.id === to);\r\n  if (!fromNode || !toNode) return null;\r\n\r\n  const startX = fromNode.position.x + NODE_WIDTH;\r\n  const startY = fromNode.position.y + NODE_HEIGHT / 2;\r\n  const endX = toNode.position.x;\r\n  const endY = toNode.position.y + NODE_HEIGHT / 2;\r\n\r\n  const cp1X = startX + (endX - startX) * 0.5;\r\n  const cp2X = endX - (endX - startX) * 0.5;\r\n\r\n  const path = `M${startX},${startY} C${cp1X},${startY} ${cp2X},${endY} ${endX},${endY}`;\r\n\r\n  return (\r\n    <path\r\n      d={path}\r\n      fill=\"none\"\r\n      stroke=\"hsl(var(--primary))\"\r\n      strokeWidth={2.5}\r\n      strokeDasharray=\"6,4\"\r\n      opacity={0.5}\r\n    />\r\n  );\r\n}\r\n\r\n// Main Component\r\nexport function N8nWorkflowBlock() {\r\n  const [nodes, setNodes] = useState<WorkflowNode[]>(initialNodes);\r\n  const [connections, setConnections] =\r\n    useState<WorkflowConnection[]>(initialConnections);\r\n  const canvasRef = useRef<HTMLDivElement>(null);\r\n  const dragStartPosition = useRef<{ x: number; y: number } | null>(null);\r\n  const [draggingNodeId, setDraggingNodeId] = useState<string | null>(null);\r\n  const [contentSize, setContentSize] = useState(() => {\r\n    const maxX = Math.max(\r\n      ...initialNodes.map((n) => n.position.x + NODE_WIDTH)\r\n    );\r\n    const maxY = Math.max(\r\n      ...initialNodes.map((n) => n.position.y + NODE_HEIGHT)\r\n    );\r\n    return { width: maxX + 50, height: maxY + 50 };\r\n  });\r\n\r\n  // Drag Handlers\r\n  const handleDragStart = (nodeId: string) => {\r\n    setDraggingNodeId(nodeId);\r\n    const node = nodes.find((n) => n.id === nodeId);\r\n    if (node) {\r\n      dragStartPosition.current = { x: node.position.x, y: node.position.y };\r\n    }\r\n  };\r\n\r\n  const handleDrag = (nodeId: string, { offset }: PanInfo) => {\r\n    if (draggingNodeId !== nodeId || !dragStartPosition.current) return;\r\n\r\n    const newX = dragStartPosition.current.x + offset.x;\r\n    const newY = dragStartPosition.current.y + offset.y;\r\n\r\n    const constrainedX = Math.max(0, newX);\r\n    const constrainedY = Math.max(0, newY);\r\n\r\n    flushSync(() => {\r\n      setNodes((prev) =>\r\n        prev.map((node) =>\r\n          node.id === nodeId\r\n            ? { ...node, position: { x: constrainedX, y: constrainedY } }\r\n            : node\r\n        )\r\n      );\r\n    });\r\n\r\n    setContentSize((prev) => ({\r\n      width: Math.max(prev.width, constrainedX + NODE_WIDTH + 50),\r\n      height: Math.max(prev.height, constrainedY + NODE_HEIGHT + 50),\r\n    }));\r\n  };\r\n\r\n  const handleDragEnd = () => {\r\n    setDraggingNodeId(null);\r\n    dragStartPosition.current = null;\r\n  };\r\n\r\n  // Add Node Handler\r\n  const addNode = () => {\r\n    const template =\r\n      nodeTemplates[Math.floor(Math.random() * nodeTemplates.length)];\r\n    const lastNode = nodes[nodes.length - 1];\r\n    const newPosition = lastNode\r\n      ? { x: lastNode.position.x + 250, y: lastNode.position.y }\r\n      : { x: 50, y: 100 };\r\n\r\n    const newNode: WorkflowNode = {\r\n      id: `node-${Date.now()}`,\r\n      ...template,\r\n      position: newPosition,\r\n    };\r\n\r\n    flushSync(() => {\r\n      setNodes((prev) => [...prev, newNode]);\r\n      if (lastNode) {\r\n        setConnections((prev) => [\r\n          ...prev,\r\n          { from: lastNode.id, to: newNode.id },\r\n        ]);\r\n      }\r\n    });\r\n\r\n    setContentSize((prev) => ({\r\n      width: Math.max(prev.width, newPosition.x + NODE_WIDTH + 50),\r\n      height: Math.max(prev.height, newPosition.y + NODE_HEIGHT + 50),\r\n    }));\r\n\r\n    // Scroll to new node\r\n    const canvas = canvasRef.current;\r\n    if (canvas) {\r\n      canvas.scrollTo({\r\n        left: newPosition.x + NODE_WIDTH - canvas.clientWidth + 100,\r\n        behavior: \"smooth\",\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative w-full overflow-hidden rounded-2xl border border-border/40 bg-background/60 backdrop-blur p-4 sm:p-6\">\r\n      {/* Header */}\r\n      <div className=\"mb-4 flex flex-wrap items-center justify-between gap-3\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <Badge\r\n            variant=\"outline\"\r\n            className=\"rounded-full border-emerald-400/40 bg-emerald-400/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.25em] text-emerald-400\"\r\n          >\r\n            Active\r\n          </Badge>\r\n          <span className=\"text-xs sm:text-sm uppercase tracking-[0.25em] text-foreground/50\">\r\n            Workflow Builder\r\n          </span>\r\n        </div>\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          onClick={addNode}\r\n          className=\"h-8 gap-2 rounded-lg text-xs uppercase tracking-[0.2em] text-foreground/70 hover:text-foreground\"\r\n          aria-label=\"Add new node\"\r\n        >\r\n          <Plus className=\"h-3.5 w-3.5\" aria-hidden=\"true\" />\r\n          <span className=\"hidden sm:inline\">Add Node</span>\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Canvas */}\r\n      <div\r\n        ref={canvasRef}\r\n        className=\"relative h-[400px] w-full overflow-auto rounded-xl border border-border/30 bg-background/40 sm:h-[500px] md:h-[600px]\"\r\n        style={{ minHeight: \"400px\" }}\r\n        role=\"region\"\r\n        aria-label=\"Workflow canvas\"\r\n        tabIndex={0}\r\n      >\r\n        {/* Content Wrapper */}\r\n        <div\r\n          className=\"relative\"\r\n          style={{\r\n            minWidth: contentSize.width,\r\n            minHeight: contentSize.height,\r\n          }}\r\n        >\r\n          {/* SVG Connections */}\r\n          <svg\r\n            className=\"absolute inset-0 pointer-events-none\"\r\n            style={{ width: contentSize.width, height: contentSize.height }}\r\n            aria-hidden=\"true\"\r\n          >\r\n            {connections.map((c) => (\r\n              <WorkflowConnectionLine\r\n                key={`${c.from}-${c.to}`}\r\n                from={c.from}\r\n                to={c.to}\r\n                nodes={nodes}\r\n              />\r\n            ))}\r\n          </svg>\r\n\r\n          {/* Nodes */}\r\n          {nodes.map((node) => {\r\n            const Icon = node.icon;\r\n            const isDragging = draggingNodeId === node.id;\r\n\r\n            return (\r\n              <motion.div\r\n                key={node.id}\r\n                drag\r\n                dragMomentum={false}\r\n                dragConstraints={{\r\n                  left: 0,\r\n                  top: 0,\r\n                  right: 100000,\r\n                  bottom: 100000,\r\n                }}\r\n                onDragStart={() => handleDragStart(node.id)}\r\n                onDrag={(_, info) => handleDrag(node.id, info)}\r\n                onDragEnd={handleDragEnd}\r\n                style={{\r\n                  x: node.position.x,\r\n                  y: node.position.y,\r\n                  width: NODE_WIDTH,\r\n                  transformOrigin: \"0 0\",\r\n                }}\r\n                className=\"absolute cursor-grab\"\r\n                initial={{ scale: 0.8, opacity: 0 }}\r\n                animate={{ scale: 1, opacity: 1 }}\r\n                transition={{ duration: 0.2 }}\r\n                whileHover={{ scale: 1.02 }}\r\n                whileDrag={{ scale: 1.05, zIndex: 50, cursor: \"grabbing\" }}\r\n                aria-grabbed={isDragging}\r\n              >\r\n                <Card\r\n                  className={`group/node relative w-full overflow-hidden rounded-xl border ${colorClasses[node.color]} bg-background/70 p-3 backdrop-blur transition-all hover:shadow-lg ${isDragging ? \"shadow-xl ring-2 ring-primary/50\" : \"\"}`}\r\n                  role=\"article\"\r\n                  aria-label={`${node.type} node: ${node.title}`}\r\n                >\r\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-foreground/[0.04] via-transparent to-transparent opacity-0 transition-opacity duration-300 group-hover/node:opacity-100\" />\r\n\r\n                  <div className=\"relative space-y-2\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div\r\n                        className={`flex h-8 w-8 shrink-0 items-center justify-center rounded-lg border ${colorClasses[node.color]} bg-background/80 backdrop-blur`}\r\n                        aria-hidden=\"true\"\r\n                      >\r\n                        <Icon className=\"h-4 w-4\" />\r\n                      </div>\r\n                      <div className=\"min-w-0 flex-1\">\r\n                        <Badge\r\n                          variant=\"outline\"\r\n                          className=\"mb-0.5 rounded-full border-border/40 bg-background/80 px-1.5 py-0 text-[9px] uppercase tracking-[0.15em] text-foreground/60\"\r\n                        >\r\n                          {node.type}\r\n                        </Badge>\r\n                        <h3 className=\"truncate text-xs font-semibold tracking-tight text-foreground\">\r\n                          {node.title}\r\n                        </h3>\r\n                      </div>\r\n                    </div>\r\n                    <p className=\"line-clamp-2 text-[10px] leading-relaxed text-foreground/70\">\r\n                      {node.description}\r\n                    </p>\r\n                    <div className=\"flex items-center gap-1.5 text-[10px] text-foreground/50\">\r\n                      <ArrowRight className=\"h-2.5 w-2.5\" aria-hidden=\"true\" />\r\n                      <span className=\"uppercase tracking-[0.1em]\">\r\n                        Connected\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </Card>\r\n              </motion.div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Footer Stats */}\r\n      <div\r\n        className=\"mt-4 flex flex-wrap items-center justify-between gap-3 rounded-lg border border-border/30 bg-background/40 px-4 py-2.5 backdrop-blur-sm\"\r\n        role=\"status\"\r\n        aria-live=\"polite\"\r\n      >\r\n        <div className=\"flex flex-wrap items-center gap-4 text-xs text-foreground/60\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <div\r\n              className=\"h-1.5 w-1.5 rounded-full bg-emerald-500\"\r\n              aria-hidden=\"true\"\r\n            />\r\n            <span className=\"uppercase tracking-[0.15em]\">\r\n              {nodes.length} {nodes.length === 1 ? \"Node\" : \"Nodes\"}\r\n            </span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <div\r\n              className=\"h-1.5 w-1.5 rounded-full bg-primary\"\r\n              aria-hidden=\"true\"\r\n            />\r\n            <span className=\"uppercase tracking-[0.15em]\">\r\n              {connections.length}{\" \"}\r\n              {connections.length === 1 ? \"Connection\" : \"Connections\"}\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <p className=\"text-[10px] uppercase tracking-[0.2em] text-foreground/40\">\r\n          Drag nodes to reposition\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n",
      "type": "registry:block",
      "target": "components/sections/n8n-workflow-block"
    }
  ]
}